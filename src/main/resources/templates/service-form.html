<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title
      th:text="${isEdit != null and isEdit} ? 'Editar Servi√ßo' : 'Cadastrar Novo Servi√ßo'"
    >
      Servi√ßo
    </title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
    />

    <style>
      body {
        background: #f8f9fa;
      }
      .form-header {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 3rem 0;
        margin-bottom: 2rem;
      }
      .form-card {
        border: none;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
      <div class="container">
        <a class="navbar-brand fw-bold text-primary" th:href="@{/}">
          <i class="bi bi-calendar-event"></i> FindenPI
        </a>
        <a th:href="@{/supplier/dashboard}" class="btn btn-outline-primary">
          <i class="bi bi-arrow-left"></i> Voltar
        </a>
      </div>
    </nav>

    <!-- Header -->
    <div class="form-header">
      <div class="container">
        <h1>
          <i
            th:class="${isEdit != null and isEdit} ? 'bi bi-pencil-square' : 'bi bi-plus-circle'"
          ></i>
          <span
            th:text="${isEdit != null and isEdit} ? 'Editar Servi√ßo' : 'Cadastrar Novo Servi√ßo'"
          ></span>
        </h1>
      </div>
    </div>

    <!-- Alert Informativo -->
    <div class="container mb-4">
      <div class="alert alert-info border-0 shadow-sm">
        <h5 class="alert-heading">
          <i class="bi bi-lightbulb-fill"></i> üí° Como funciona o portf√≥lio?
        </h5>
        <hr />
        <ul class="mb-0">
          <li>
            <strong>Imagem Principal:</strong> Aparece no card do servi√ßo na
            listagem
          </li>
          <li>
            <strong>Galeria de Imagens:</strong> Mostre fotos de trabalhos
            realizados (portf√≥lio)
          </li>
          <li>
            <strong>V√≠deos:</strong> Links do YouTube, Vimeo ou outros para
            demonstrar seu trabalho
          </li>
          <li>
            <strong>üì¢ Seu servi√ßo ficar√° vis√≠vel</strong> para todos os
            organizadores no seu perfil p√∫blico!
          </li>
        </ul>
      </div>
    </div>

    <!-- Mensagens -->
    <div class="container">
      <div
        th:if="${success}"
        class="alert alert-success alert-dismissible fade show"
      >
        <i class="bi bi-check-circle-fill"></i>
        <span th:text="${success}"></span>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
        ></button>
      </div>

      <div
        th:if="${error}"
        class="alert alert-danger alert-dismissible fade show"
      >
        <i class="bi bi-exclamation-triangle-fill"></i>
        <span th:text="${error}"></span>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
        ></button>
      </div>
    </div>

    <!-- Formul√°rio -->
    <div class="container pb-5">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="card form-card">
            <div class="card-body p-4">
              <form
                th:action="${isEdit != null and isEdit} ? @{'/services/edit/' + ${serviceDTO.id}} : @{/services/new}"
                th:object="${serviceDTO}"
                method="post"
              >
                <!-- T√≠tulo -->
                <div class="mb-3">
                  <label class="form-label fw-bold">T√≠tulo do Servi√ßo *</label>
                  <input
                    type="text"
                    th:field="*{title}"
                    class="form-control"
                    placeholder="Ex: Buffet Completo para 100 Pessoas"
                    required
                  />
                  <div class="text-danger small" th:errors="*{title}"></div>
                </div>

                <!-- Categoria -->
                <div class="mb-3">
                  <label class="form-label fw-bold">Categoria *</label>
                  <select
                    id="categorySelect"
                    th:field="*{categoryId}"
                    class="form-select"
                    required
                  >
                    <option value="">Selecione uma categoria</option>
                    <option
                      th:each="category : ${categories}"
                      th:value="${category.id}"
                      th:text="${category.icon + ' ' + category.name}"
                      th:data-name="${category.name}"
                    >
                      Categoria
                    </option>
                  </select>
                  <div
                    class="text-danger small"
                    th:errors="*{categoryId}"
                  ></div>
                </div>

                <!-- Descri√ß√£o -->
                <div class="mb-3">
                  <label class="form-label fw-bold">Descri√ß√£o *</label>
                  <textarea
                    th:field="*{description}"
                    class="form-control"
                    rows="5"
                    placeholder="Descreva em detalhes o servi√ßo oferecido..."
                    required
                  ></textarea>
                  <div
                    class="text-danger small"
                    th:errors="*{description}"
                  ></div>
                  <small class="text-muted">M√≠nimo 20 caracteres</small>
                </div>

                <!-- Pre√ßo e Dura√ß√£o -->
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold">Pre√ßo (R$) *</label>
                    <input
                      type="number"
                      th:field="*{price}"
                      class="form-control"
                      step="0.01"
                      min="0"
                      placeholder="0.00"
                      required
                    />
                    <div class="text-danger small" th:errors="*{price}"></div>
                  </div>

                  <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold">Dura√ß√£o</label>
                    <input
                      type="text"
                      th:field="*{duration}"
                      class="form-control"
                      placeholder="Ex: 4 horas"
                    />
                    <small class="text-muted">Opcional</small>
                  </div>
                </div>

                <!-- Localiza√ß√£o e Capacidade -->
                <div class="row">
                  <div class="col-md-8 mb-3">
                    <label class="form-label fw-bold">Localiza√ß√£o</label>
                    <input
                      type="text"
                      th:field="*{location}"
                      class="form-control"
                      placeholder="Ex: S√£o Paulo - SP"
                    />
                    <small class="text-muted">Opcional</small>
                  </div>

                  <div class="col-md-4 mb-3">
                    <label class="form-label fw-bold">Capacidade</label>
                    <input
                      type="number"
                      th:field="*{capacity}"
                      class="form-control"
                      placeholder="Ex: 100"
                    />
                    <small class="text-muted">N¬∫ de pessoas</small>
                  </div>
                </div>

                <hr class="my-4" />

                <!-- PORTF√ìLIO -->
                <h5 class="mb-3">
                  <i class="bi bi-images"></i> Portf√≥lio (Imagens e V√≠deos)
                </h5>

                <!-- URL principal da imagem -->
                <div class="mb-3">
                  <label class="form-label fw-bold">Imagem Principal *</label>
                  <input
                    type="url"
                    th:field="*{imageUrl}"
                    class="form-control"
                    placeholder="https://exemplo.com/imagem-principal.jpg"
                  />
                  <small class="text-muted"
                    >Esta imagem aparece no card do servi√ßo</small
                  >
                </div>

                <!-- Imagens do servi√ßo -->
                <div class="mb-4">
                  <label class="form-label fw-bold"
                    >Galeria de Imagens (Portf√≥lio)</label
                  >
                  <div id="imagesContainer">
                    <div
                      class="input-group mb-2"
                      th:each="img, stat : ${serviceDTO.serviceImages}"
                    >
                      <input
                        type="url"
                        th:field="*{serviceImages[__${stat.index}__]}"
                        class="form-control"
                        placeholder="https://exemplo.com/portfolio1.jpg"
                      />
                      <button
                        type="button"
                        class="btn btn-outline-danger"
                        onclick="this.parentElement.remove()"
                      >
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </div>
                  <button
                    type="button"
                    class="btn btn-outline-primary btn-sm"
                    id="addImageBtn"
                  >
                    <i class="bi bi-plus"></i> Adicionar Imagem ao Portf√≥lio
                  </button>
                </div>

                <!-- V√≠deos do servi√ßo -->
                <div class="mb-4">
                  <label class="form-label fw-bold"
                    >V√≠deos (YouTube, Vimeo, etc)</label
                  >
                  <div id="videosContainer">
                    <div
                      class="input-group mb-2"
                      th:each="vid, stat : ${serviceDTO.serviceVideos}"
                    >
                      <input
                        type="url"
                        th:field="*{serviceVideos[__${stat.index}__]}"
                        class="form-control"
                        placeholder="https://youtube.com/watch?v=..."
                      />
                      <button
                        type="button"
                        class="btn btn-outline-danger"
                        onclick="this.parentElement.remove()"
                      >
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </div>
                  <button
                    type="button"
                    class="btn btn-outline-primary btn-sm"
                    id="addVideoBtn"
                  >
                    <i class="bi bi-plus"></i> Adicionar V√≠deo
                  </button>
                </div>

                <hr class="my-4" />

                <!-- Caracter√≠sticas -->
                <div class="mb-4">
                  <label class="form-label fw-bold"
                    >Caracter√≠sticas do Servi√ßo</label
                  >
                  <div id="featuresContainer">
                    <div
                      class="input-group mb-2"
                      th:each="feature, stat : ${serviceDTO.features}"
                    >
                      <input
                        type="text"
                        th:field="*{features[__${stat.index}__]}"
                        class="form-control"
                        placeholder="Ex: Inclui gar√ßons"
                      />
                      <button
                        type="button"
                        class="btn btn-outline-danger"
                        onclick="this.parentElement.remove()"
                      >
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </div>
                  <button
                    type="button"
                    class="btn btn-outline-primary btn-sm"
                    id="addFeatureBtn"
                  >
                    <i class="bi bi-plus"></i> Adicionar Caracter√≠stica
                  </button>
                </div>

                <!-- Bot√µes -->
                <div class="d-flex justify-content-between pt-3">
                  <a
                    th:href="@{/supplier/dashboard}"
                    class="btn btn-outline-secondary"
                  >
                    <i class="bi bi-x-circle"></i> Cancelar
                  </a>
                  <button type="submit" class="btn btn-primary btn-lg">
                    <i
                      th:class="${isEdit != null and isEdit} ? 'bi bi-check-circle' : 'bi bi-plus-circle'"
                    ></i>
                    <span
                      th:text="${isEdit != null and isEdit} ? 'Salvar Altera√ß√µes' : 'Cadastrar Servi√ßo'"
                    ></span>
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Adicionar caracter√≠sticas
      let featureIndex = document.querySelectorAll(
        "#featuresContainer .input-group"
      ).length;
      document
        .getElementById("addFeatureBtn")
        .addEventListener("click", function () {
          const container = document.getElementById("featuresContainer");
          const newFeature = document.createElement("div");
          newFeature.className = "input-group mb-2";
          newFeature.innerHTML = `
                <input type="text" name="features[${featureIndex}]" class="form-control" placeholder="Ex: Inclui gar√ßons">
                <button type="button" class="btn btn-outline-danger" onclick="this.parentElement.remove()">
                    <i class="bi bi-trash"></i>
                </button>
            `;
          container.appendChild(newFeature);
          featureIndex++;
        });

      // Adicionar imagens
      let imageIndex = document.querySelectorAll(
        "#imagesContainer .input-group"
      ).length;
      document
        .getElementById("addImageBtn")
        .addEventListener("click", function () {
          const container = document.getElementById("imagesContainer");
          const newInput = document.createElement("div");
          newInput.className = "input-group mb-2";
          newInput.innerHTML = `
                <input type="url" name="serviceImages[${imageIndex}]" class="form-control" 
                       placeholder="https://exemplo.com/portfolio${
                         imageIndex + 1
                       }.jpg">
                <button type="button" class="btn btn-outline-danger" onclick="this.parentElement.remove()">
                    <i class="bi bi-trash"></i>
                </button>
            `;
          container.appendChild(newInput);
          imageIndex++;
        });

      // Adicionar v√≠deos
      let videoIndex = document.querySelectorAll(
        "#videosContainer .input-group"
      ).length;
      document
        .getElementById("addVideoBtn")
        .addEventListener("click", function () {
          const container = document.getElementById("videosContainer");
          const newInput = document.createElement("div");
          newInput.className = "input-group mb-2";
          newInput.innerHTML = `
                <input type="url" name="serviceVideos[${videoIndex}]" class="form-control" 
                       placeholder="https://youtube.com/watch?v=...">
                <button type="button" class="btn btn-outline-danger" onclick="this.parentElement.remove()">
                    <i class="bi bi-trash"></i>
                </button>
            `;
          container.appendChild(newInput);
          videoIndex++;
        });
    </script>
  </body>
</html>
